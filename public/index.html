<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Analysis Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .loading {
            display: none;
        }
        .loading.active {
            display: block;
        }
        .result {
            display: none;
        }
        .result.active {
            display: block;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-3xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h1 class="text-3xl font-bold text-gray-900 mb-6">Financial Analysis Tool</h1>
                
                <div class="mb-6">
                    <label for="ticker" class="block text-sm font-medium text-gray-700 mb-2">Stock Ticker Symbol</label>
                    <div class="flex gap-2">
                        <input type="text" id="ticker" name="ticker" 
                               class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
                               placeholder="e.g., AAPL">
                        <button onclick="analyzeStock()" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            Analyze
                        </button>
                    </div>
                </div>

                <div id="loading" class="loading">
                    <div class="flex items-center justify-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                        <span class="ml-2 text-gray-600">Analyzing stock data...</span>
                    </div>
                </div>

                <div id="result" class="result">
                    <div class="border-t border-gray-200 pt-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Analysis Results</h2>
                        <div id="result-content" class="prose max-w-none">
                            <!-- Results will be inserted here -->
                        </div>
                    </div>
                </div>

                <div id="error" class="hidden mt-4 p-4 bg-red-50 text-red-700 rounded-md">
                    <!-- Error messages will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            "apiKey": "AIzaSyDTVrNzD-YYFnvqakAk1LysPe8jPrpyScc",
            "authDomain": "fintech-ash-80b97.firebaseapp.com",
            "projectId": "fintech-ash-80b97",
            "storageBucket": "fintech-ash-80b97.firebasestorage.app",
            "messagingSenderId": "972685478512",
            "appId": "1:972685478512:web:34d1aa305be183112702b5",
            "measurementId": "G-FHFL400HD3"
        };
        firebase.initializeApp(firebaseConfig);
        const analytics = firebase.analytics();
        const db = firebase.firestore();
        const auth = firebase.auth();

        async function analyzeStock() {
            const ticker = document.getElementById('ticker').value.trim().toUpperCase();
            if (!ticker) {
                showError('Please enter a ticker symbol');
                return;
            }

            // Show loading, hide results and error
            document.getElementById('loading').classList.add('active');
            document.getElementById('result').classList.remove('active');
            document.getElementById('error').classList.add('hidden');

            try {
                // Log analytics event
                analytics.logEvent('analyze_stock', { ticker: ticker });

                const response = await fetch('https://us-central1-fintech-ash-80b97.cloudfunctions.net/analyze_stock_endpoint', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ ticker }),
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'An error occurred');
                }

                // Store analysis result in Firestore
                await db.collection('stock_analysis').add({
                    ticker: ticker,
                    result: data,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Display results
                document.getElementById('result-content').innerHTML = formatResults(data);
                document.getElementById('result').classList.add('active');
            } catch (error) {
                showError(error.message);
            } finally {
                document.getElementById('loading').classList.remove('active');
            }
        }

        function formatResults(data) {
            // Format the results based on the data structure
            let html = '';
            
            // Add financial metrics
            if (data.financial_metrics) {
                html += '<h3 class="text-lg font-semibold mb-2">Financial Metrics</h3>';
                html += '<div class="grid grid-cols-2 gap-4 mb-4">';
                for (const [key, value] of Object.entries(data.financial_metrics)) {
                    html += `
                        <div class="bg-gray-50 p-3 rounded-md">
                            <div class="text-sm text-gray-600">${key}</div>
                            <div class="font-medium">${value}</div>
                        </div>
                    `;
                }
                html += '</div>';
            }

            // Add analysis summary
            if (data.analysis_summary) {
                html += '<h3 class="text-lg font-semibold mb-2">Analysis Summary</h3>';
                html += `<div class="bg-gray-50 p-4 rounded-md">${data.analysis_summary}</div>`;
            }

            return html;
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }
    </script>
</body>
</html> 